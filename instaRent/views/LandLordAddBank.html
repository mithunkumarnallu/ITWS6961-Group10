{% extends 'partials/layout.html' %}

{% block myHead %}

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->

<!--<head>-->

    <script src="https://checkout.stripe.com/checkout.js"></script>
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

<!--</head>-->

{% endblock %}

<!--<body>-->
{% block myBody %}

    <div class = "container">
        <legend>Bank Accounts</legend>
        <ol class="breadcrumb">
                    <li>
                        <i class="fa fa-dashboard"></i>  <a href="/dashboard">Dashboard</a>
                    </li>
                    <li class="active">
                        <i class="fa fa-fw fa-university"></i></i> Add Bank Account
                    </li>
                </ol>
        <div class="row">
            <div class="col-sm-8">
                <form method="POST" id="inst-form" role="form">
                    <div class="form-group">
                        <label for="tbAccountNo">Account No</label>
                        <input id="tbAccountNo" class="form-control" type="text" data-stripe="accountNumber">
                    </div>
                    <div class="form-group">
                        <label for="routingno">Routing No</label>
                       <input size="15" id="routingno" class="form-control" type="text" data-stripe="routingNumber">
                    </div>
                    <div class="form-group">
                        <label for="firstname">First Name</label>
                        <input id="firstname" class="form-control" type="text" data-stripe="FirstName">
                    </div>
                    <div class="form-group">
                        <label for="LastName">Last name</label>
                        <input id="LastName" class="form-control" type="text" data-stripe="LastName">
                    </div>
                    <button type="submit" class="btn btn-danger" id="button">Submit</button>
                </form>
                </div>
            </div>
    </div>

<script type="text/javascript">
    Stripe.setPublishableKey('pk_test_jwW7JFcTZaD8HmJdFZgeh4TR');
    var stripeResponseHandler = function(status, response) {
        var $form = $('#inst-form');
        if (response.error)
        {
           console.log(response.error);

            $form.find('button').prop('disabled', false);
        }
        else
        {
            console.log(JSON.stringify(response));
            var token = response.id;
            var route = $('#routingno').val();
            var accno = $('#tbAccountNo').val();
            var fn =  $('#firstname').val();
            var ln = $('#LastName').val();
            $.ajax(
                    {
                        type: 'POST',
                        url: "/payments/addLandlordAccount",
                        data:{accNo:accno , routeNo:route , tokenID:token , fn:fn , ln: ln},
                        success: function (responseData) {
                            console.log(JSON.stringify(responseData));
                        }
                    });
        }
    }


    $('#button').click(function() {
           $('#button').prop('disabled', true);
            // Create a token with Stripe
            Stripe.bankAccount.createToken({
                country: 'US',
                currency: 'USD',
                routing_number:  $('#routingno').val(),
                account_number: $('#tbAccountNo').val()
            }, stripeResponseHandler);
            return false;
        });




</script>

<!--</body>-->
{% endblock %}
<!--</html>-->
